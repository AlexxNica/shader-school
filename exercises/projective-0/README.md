# Clip coordinates

This lesson requires a bit more mathematics than the previous lessons.  However, it is necessary to understand this material in order to work with 3D graphics.

## Projective geometry

You may have noticed from the first example that `gl_Position` is a 4D vector. At first this might seem a bit funny, but there is a good reason for this. Objects on the GPU are represented in what is known as a *homogeneous* coordinate system. While this may seem abstract, understanding homogeneous coordinates - and more broadly projective geometry - is essential for graphics programming. 

The basic idea in projective geometry is to replace points a space with lines passing through the origin in a space which is one dimension higher. One nice property of lines passing through the origin is that they can be parameterized by vectors.  For example, in a 3+1D projective geometry, the vector `[2, 0, 0, 1]` generates a line with points `[4, 0, 0, 2]`,  `[1, 0, 0, 0.5]`, `[2000, 0, 0, 1000]` and so on.  That is, we say that two vectors `[x0,y0,z0,w0]` and `[x1,y1,z1,w1]`, identify the same line if they are related by some non-zero scalar multiple `t != 0`:

```
        [x0,y0,z0,w0]  ~  [x1,y1,z1,w1]

            if and only if

[t*x0,t*y0,t*z0,t*w0]  ~  [x1,y1,z1,w1]
```


Lines through the origin can be identified with points in a normal Euclidean space by intersecting them with a hyperplane that does not pass through the origin.

In WebGL this hyperplane is taken to be the solution set to `w=1`.  To see how this works concretely, let us intersect a line generated by the vector `[0.2, 0.3, 0, 0.5]` with this hyperplane.  That is, it is the point `t * [0.2, 0.3, 0, 0.1]` where,

```
0.1 * t = 1
```

Solving for `t` gives `t=10`, so this line is identified with the 3D point `[2, 3, 0]`.

More generally, in WebGL any vector `[x,y,z,w]`, corresponds to the 3D point `[x/w,y/w,z/w]`.

### Points at infinity

However, projective geometry is a little bit different than plane geometry. Specifically, there are a few extra points which correspond to the lines that do not pass through the hyperplane.  In WebGL, these are the points where `w=0`. Geometers call these extra points, the *points at infinity*.  While these things may seem a bit funny at first, adding them greatly simplifies the problem of handling degeneracies and certain extraordinary situations, much like the `Infinity` number in JavaScript. One way to think of points at infinity is that they act like idealized direction vectors instead of proper points.

## Clip coordinates on the GPU

Clip coordinates, which are the coordinate system in which the GPU interprets `gl_Position` are related to screen coordinates according to the following relation:

```
screenColumn = 0.5 * screenWidth  * (gl_Position.x / gl_Position.w + 1.0)
screenRow    = 0.5 * screenHeight * (1.0 - gl_Position.y / gl_Position.w)
```

A similar equation holds for the depth value of the vertex:

```
depth = gl_Position.z / gl_Position.w
```

The main motivation (and also the origin of the name "clip" coordinates) comes from the fact that this rule greatly simplifies the problem of testing if a given point is visible or not. Specifically, all of the drawable geometry is "clipped" against a viewable frustum which is define by 6 inequalities:

```
-w < x < w
-w < y < w
 0 < z < w
```

Working backwards from the formula for projecting points in clip coordinates to the screen, you can check that the first two inequations are sufficient to determine that no points are drawn outside of the viewable bounds. The last inequation constrains that no objects behind the camera are drawn and that points where `z>=1` are clipped.

## Transformations in projective geometry

One of the biggest advantages of projective coordinates is that they greatly simplify geometric transformations. Specifically, in projective geometry each of the following types of transformations is a special case of a *projective transformation*:

* Translations
* Rotations
* Reflections
* Scaling
* Shearing
* Perspective warping (aka homographies)

In projective geometry

### Transforming points

### Transforming functions


## Exercise

